/* core_generic-ui 8.21.0 2018-01-30T22:08:43+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){"use strict";angular.module("c8y.genericUi",[])}(),function(){"use strict";function e(e,t,n,r,i,o,c,a){function s(){return c.list().then(function(e){return _.filter(e,"c8y_JsonSchema.fragmentType")})}function p(e){return C().then(function(t){return _.some(t,function(t){return l(e,t).length})})}function u(e,t){return _.reduce(t,function(t,n){return t.concat(l(e,n))},[])}function l(e,t){var n=_.keys(e),r=_.get(t,U),i=[];if(void 0!==r){var o=new RegExp(r);i=n.filter(function(e){return o.test(e)}).map(function(e){return{key:e,schema:t}})}return i}function m(e,t,n){var r=_.assign({managedObject:t,object:_.get(t,n)});return d(e,r)}function g(e,t,n,r){return d(e,_.assign({managedObject:t,object:_.get(t,n.path),property:n.key},r))}function d(e,n){var r=e.replace(/\${([^}]+)}/g,"{{$1}}"),i=t(r);return i(n)}function y(e,t,n,r){var i=_.get(t,n),o=_.get(e,"id"),a=_.keys(i),s=c.getProperties(e),p=s;return r||(p=_.filter(p,function(e){var t=e.key;return _.includes(a,t)})),_.map(p,function(e){return _.assign({operationList:[],schemaId:o,path:n},e)})}function f(e){var t=function(e){return-(e.priority||0)},n=function(e){return _.lowerCase(r.getString(e.title)||e.key)};return _.sortBy(e,[t,n])}function v(t){var n=a.status,r=n.PENDING,i=n.EXECUTING,o=[r,i],c=1e3,s=function(e){return{deviceId:t,status:e,pageSize:c}};if(!$[t]){var p=o.map(s).map(a.list),u=$[t]=e.all(p).then(_.flatten);u.finally(function(){return _.unset($,t)})}return $[t]}function h(e,t,n,r){var i=b(e,t,n,r);return a.createWithNotifications(i)}function b(e,t,n,r){var i=_.pick(n,["schemaId","path","key"]);return i.operation=t,_.assign({c8y_JsonSchemaContext:i,deviceId:r.id,deviceName:r.name,description:t},e)}function x(e){var t=n("Operation created successfully.");e.then(function(){return i.success(t)})}function S(e){var t=n('Operation "{{description}}" completed successfully.'),o=n('Operation "{{description}}" completed with failure.'),c=n('Operation "{{description}}" completed with failure: "{{failureReason}}".');e.then(function(e){e.status===a.status.SUCCESSFUL?i.success(r.getString(t,e)):e.failureReason?i.danger(r.getString(c,e),e):i.danger(r.getString(o,e))})}function I(e){return _.some(e,function(e){return!e.readonly&&"operations"!==e.type})}var O="c8y_JsonSchema",U=O+".fragmentType",$={},C=_.memoize(s,_.identity);return{hasMatchingSchemas:p,matchObjectWithSchemas:u,listSchemas:C,replaceObjectPlaceholders:m,replaceOperationTemplatePlaceholders:g,getProperties:y,listPendingOperations:v,createOperation:h,sortProperties:f,alertOperationCreateSuccess:x,alertOperationComplete:S,showSave:I}}e.$inject=["$q","$interpolate","gettext","gettextCatalog","c8yAlert","c8yInventory","c8yJsonSchemas","c8yDeviceControl"],angular.module("c8y.genericUi").factory("c8yGenericUi",e)}(),function(){"use strict";function e(e,t){function n(){}function r(t){var n=t.path,r=_.assign({},t,{template:a,controllerAs:"vm",controller:i});e.when(n,r)}function i(e){this.deviceId=e.deviceId}function o(){r({path:"/device/:deviceId",name:t("Objects"),icon:"c8y-modules",showIf:c})}function c(e,t,n){return t.detailCached(e.deviceId).then(function(e){return e.data}).then(function(e){return e[s]&&n.hasMatchingSchemas(e)})}i.$inject=["$routeParams"],c.$inject=["$routeParams","c8yInventory","c8yGenericUi"];var a='<c8y-generic-ui-auto context="vm.deviceId"></c8y-generic-ui-auto>',s="c8y_GenericUi";return{$get:n,configView:r,configDefaultView:o}}e.$inject=["c8yViewsProvider","gettext"],angular.module("c8y.genericUi").provider("c8yGenericUiConfig",e)}(),function(){"use strict";function e(e,t,n){var r=this;r.$onChanges=function(){t.detail(r.context).then(n.getResData).then(function(e){return _.assign(r,{managedObject:e})}),e.listSchemas().then(function(e){return _.assign(r,{schemas:e})})}}e.$inject=["c8yGenericUi","c8yInventory","c8yBase"],angular.module("c8y.genericUi").component("c8yGenericUiAuto",{templateUrl:"core_generic-ui/generic-ui-auto.html",controllerAs:"vm",controller:e,bindings:{context:"<"}})}(),function(){"use strict";function e(e,t,n,r){function i(e){var t=_.get(e,"context.currentValue.id")!==_.get(e,"context.previousValue.id");(t||e.schemas)&&(a(),c())}function o(){p()}function c(){if(p(),_.get(m,"context.id")){var e=n.realtimeActions(),t=e.UPDATE,r="/managedobjects/"+m.context.id;n.addListener(g,r,t,function(e,t){return s(t)}),n.start(g,r),f.push(r)}}function a(){m.matches=t.matchObjectWithSchemas(m.context,m.schemas),m.rows=u(m.matches.map(l))}function s(e){var n=t.matchObjectWithSchemas(e,m.schemas),i=_.map(m.matches,"key"),o=_.map(n,"key"),c=_.difference(o,i).length||_.difference(i,o).length;c&&(m.context=r.updateManagedObject(m.context,e),a())}function p(){_.uniq(f).forEach(function(e){return n.destroySubscription(g,e)}),f=[]}function u(e){var t=_.sortBy(e,"title");return _.chunk(t,y)}function l(e){var n=m.context,r=_.get(e.schema,"c8y_JsonSchema"),i=r.titleDisplay?t.replaceObjectPlaceholders(r.titleDisplay,n,e.key):r.title;return _.assign({managedObject:n,title:i},e)}var m=this,g=e.$id,d="col-xs-12 col-sm-6 col-md-4",y=3,f=[];_.assign(m,{$onChanges:i,$onDestroy:o,cardSizeClass:d})}e.$inject=["$scope","c8yGenericUi","c8yRealtime","c8yInventory"],angular.module("c8y.genericUi").component("c8yGenericUi",{templateUrl:"core_generic-ui/generic-ui.html",controllerAs:"vm",controller:e,bindings:{schemas:"<",context:"<"}})}(),function(){"use strict";function e(e,t,n,r,i,o){function c(e){if(g(),e.context){var t=_.get(e.context,"currentValue.id");d(e.context),s(t)}}function a(){p()}function s(e){if(p(),e){var t=r.realtimeActions(),n=t.UPDATE,i=t.CREATE,o="/operations/"+e,c="/managedobjects/"+e;r.addListener(h,o,n,function(e,t){return u(t)}),r.addListener(h,o,i,function(e,t){return u(t)}),r.addListener(h,c,n,function(e,t){return m(t)}),r.start(h,o),r.start(h,c),x=x.concat([o,c])}}function p(){_.uniq(x).forEach(function(e){return r.destroySubscription(h,e)}),x=[]}function u(e){var t=_.find(b.operations,_.pick(e,"id"));t?_.assign(t,e):(b.operations.push(e),l(e))}function l(e){var t=_.pick(e.c8y_JsonSchemaContext,["key","schemaId","path"]);if(t){var n=_.find(b.properties,function(e){var n=e.key,r=e.schemaId,i=e.path;return _.isEqual({key:n,schemaId:r,path:i},t)});n&&n.operationList.push(e)}}function m(e){b.context=n.updateManagedObject(b.context,e),g()}function g(){var e=b.path,n=b.schema,r=b.context,i=b.includeUndefined,o=t.getProperties(n,r,e,i),c=_.map(b.properties,"key"),a=_.map(o,"key"),s=_.difference(a,c).length||_.difference(c,a).length;s&&(b.properties=t.sortProperties(o),b.showSave=t.showSave(b.properties))}function d(e){var n=_.get(e,"previousValue.id"),r=_.get(e,"currentValue.id");n!==r&&(b.operations=[],t.listPendingOperations(r).then(function(e){return _.forEach(e,u)}))}function y(e,n,r){var i=b.context,o=b.schema;return t.createOperation(e,n,r,i,o).then(function(e){var n=e.created,r=e.completed;return t.alertOperationCreateSuccess(n),t.alertOperationComplete(r),n})}function f(){var e=_.pick(b.context,["id",b.path]);b.saving=!0,n.update(e).then(v).finally(function(){b.saving=!1})}function v(){e.MainForm.$setPristine();var t=o("Object successfully updated.");i.success(t)}var h=e.$id,b=this,x=[];_.assign(b,{$onChanges:c,$onDestroy:a,operations:[],createOperation:y,save:f})}e.$inject=["$scope","c8yGenericUi","c8yInventory","c8yRealtime","c8yAlert","gettext"],angular.module("c8y.genericUi").component("c8yGenericUiInventory",{templateUrl:"core_generic-ui/generic-ui-inventory.html",controllerAs:"vm",controller:e,bindings:{path:"<",schema:"<",context:"<",includeUndefined:"<",title:"<"}})}(),function(){"use strict";function e(e,t,n,r,i){function o(){h.schema={type:"object",properties:_defineProperty({},h.property.key,h.property)},h.inputValueSchema={type:"object",properties:{inputValue:h.property},required:["inputValue"]},h.form=[{key:[h.property.key],notitle:!0,description:!1}],h.inputValueForm=[{key:["inputValue"],title:"Input value",description:!1,readonly:!1}],h.placeholders={inputValue:_.cloneDeep(_.get(h.context,h.property.path+"."+h.property.key))}}function c(){h.model!==_.get(h.context,h.property.path)&&(h.model=_.get(h.context,h.property.path))}function a(e,t){var r=JSON.parse(n.replaceOperationTemplatePlaceholders(e.template,h.context,h.property,t));h.createOperation({operation:r,name:e.name})}function s(){var e=f();return e.length}function p(){var e=f(),t=_.countBy(e,"status"),n=_.reduce(t,function(e,t,n){var r=e,i=u(t,n);return r&&i&&(r+="<br>"),r+i},"");return n||i.getString("No recent operations")}function u(e,t){var n={PENDING:i.getPlural(e,"1 operation pending","{{$count}} operations pending",{}),EXECUTING:i.getPlural(e,"1 operation executing","{{$count}} operations executing",{}),FAILED:i.getPlural(e,"1 operation failed","{{$count}} operations failed",{}),SUCCESSFUL:i.getPlural(e,"1 operation successful","{{$count}} operations successful",{})};return e?n[t]:""}function l(){var e=f(),t=_.countBy(e,"status"),n=_.keys(t);return 0===n.length?"badge-light":1===n.length?x[n[0]]:_.includes(n,"EXECUTING")?x.EXECUTING:_.includes(n,"PENDING")?x.PENDING:"badge-warning"}function m(){return t.open({size:"md",component:"c8yUiOperationsTimelineModal",resolve:{title:function(){return{icon:"list",text:h.property.title}},timelineHeader:function(){return r("Recent operations")},operations:function(){return h.operations},extraButtons:function(){return[{label:r("View history"),action:function(){return e.path("/device/"+h.context.id+"/control")},cls:"btn-primary"}]}}}).result}function g(e){return _.includes(e.template,"${inputValue}")}function d(){return _.get(h.property,"operations.length",0)>0}function y(){return"operations"!==h.property.type}function f(){return _.filter(h.operations,function(e){return _.isEqual(_.pick(e.c8y_JsonSchemaContext,["schemaId","path","key"]),_.pick(h.property,["schemaId","path","key"]))})}function v(e){return _.some(h.operations,function(t){return _.get(t,"c8y_JsonSchemaContext.operation")===e.name&&("EXECUTING"===t.status||"PENDING"===t.status)})}var h=this,b="core_generic-ui/generic-ui-inventory-property-operation-popover.html";_.assign(h,{$onChanges:o,$doCheck:c,execute:a,getOperationsBadgeClass:l,getOperationsCount:s,getOperationsTooltip:p,openOperationsModal:m,operationPopoverTemplate:b,needsUserInput:g,noOperationsSupported:d,needsForm:y,isInProgress:v});var x={PENDING:"badge-info",EXECUTING:"badge-info",SUCCESSFUL:"badge-success",FAILED:"badge-danger"}}e.$inject=["$location","$uibModal","c8yGenericUi","gettext","gettextCatalog"],angular.module("c8y.genericUi").component("c8yGenericUiInventoryProperty",{bindings:{property:"<",context:"<",operations:"<",createOperation:"&"},templateUrl:"core_generic-ui/generic-ui-inventory-property.html",controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(){return{id:String(Math.random()).substr(2),name:"Generic UI Testing Device A",com_cumulocity_model_Agent:{},c8y_IsDevice:{},"c8y_Lwm2m_3202!1":{5600:.2,5601:"hello world",5602:!0,operations:null,instance:1},"c8y_Lwm2m_3202!2":{5600:.4,5602:!1,instance:2},"c8y_Lwm2m_3202!3":{5600:2.323,5601:"hi there!d",instance:3}}}function t(e){return _.merge({appliesTo:{INVENTORY:!0},type:"c8y_JsonSchema",c8y_JsonSchema:{fragmentType:"c8y_Lwm2m_3202!(\\d+)",type:"object",title:"Analog Readings",titleDisplay:"Analog Readings: Instance ${object.instance}",properties:{5001:{title:"Some name",description:"Some string",type:"string",operations:[{name:"read",template:'{"c8yShell": "READ /3202/${obj.instance}/${property}"}'}]},5600:{title:"Analog Input Current Value",description:"The current value of the analog input.",operations:[{name:"write",template:'{"c8yShell": "WRITE /3202/${obj.instance}/${property} ${inputValue}"}'},{name:"read",template:'{"c8yShell": "READ /3202/${obj.instance}/${property}"}'}],minimum:0,maximum:1,type:"number",readOnly:!0},5602:{title:"Toggle property",description:"Toggle property",type:"boolean"},operations:{type:"operations",title:"Operations",priority:10,operations:[{name:"add instance",template:'{"c8yShell": "ADD INSTANCE 3202"}'},{name:"discover",template:'{"c8yShell": "DISCOVER 3202"}'}],readonly:"true"}}}},e)}angular.module("c8y.genericUi").constant("genericUiFakeMo",e).constant("genericUiFakeSchema",t)}(),function(){"use strict";function e(e){var t;t='<c8y-generic-ui schemas="vm.schemas" context="vm.managedObject"></c8y-generic-ui>',e.put("core_generic-ui/generic-ui-auto.html",t),e.put("/apps/core/generic-ui/generic-ui-auto.html",t),t='<ng-form name="inputValueForm">\r\n  <c8y-schema-form schema="vm.inputValueSchema" form="vm.inputValueForm" model="vm.placeholders" options="vm.options" class="form-group-sm">\r\n  </c8y-schema-form>\r\n  <button type="button" ng-disabled="inputValueForm.$invalid || vm.isInProgress(operation)" ng-click="vm.execute(operation, vm.placeholders); vm.popoverOpen = false;" class="btn btn-default btn-xs">\r\n    Execute\r\n  </button>\r\n</ng-form>\r\n',e.put("core_generic-ui/generic-ui-inventory-property-operation-popover.html",t),e.put("/apps/core/generic-ui/generic-ui-inventory-property-operation-popover.html",t),t='<!-- <pre style="font-size:8px;">{{vm.property}}</pre> -->\n<div class="form-group form-group-sm">\n  <label>\n    {{vm.property.title}}\n    <a href="" class="btn-help" uib-popover="{{vm.property.description}}" popover-trigger="\'focus\'" popover-append-to-body="true" popver-placement="right">\n      <i ng-if="vm.property.description" c8y-icon="question-circle-o">\n      </i>\n    </a>\n  </label>\n\n  <c8y-schema-form ng-if="vm.needsForm()" schema="vm.schema" form="vm.form" model="vm.model" options="vm.options">\n  </c8y-schema-form>\n\n  <div class="flex-row wrap">\n    <span ng-repeat="operation in vm.property.operations" class="right-m-xs">\n      <button ng-if="!vm.needsUserInput(operation)" type="button" ng-disabled="vm.isInProgress(operation)" ng-click="vm.execute(operation)" ng-class="{\'btn-pending\': vm.isInProgress(operation)}" class="btn btn-default btn-xs" title="{{operation.name}}">\n        {{operation.name}}\n      </button>\n      <button ng-if="vm.needsUserInput(operation)" type="button" uib-popover-template="vm.operationPopoverTemplate" popover-placement="auto" popover-append-to-body="true" popover-trigger="\'click\'" popover-is-open="vm.popoverOpen" ng-disabled="vm.isInProgress(operation)" ng-class="{\'btn-pending\': vm.isInProgress(operation)}" class="btn btn-default btn-xs">\n        {{operation.name}}\n      </button>\n    </span>\n\n    <button type="button" class="btn btn-xs btn-default flex-item-right" ng-if="vm.noOperationsSupported()" ng-click="vm.openOperationsModal()">\n      <i c8y-icon="list"></i>\n      <span class="badge" uib-tooltip-html="vm.getOperationsTooltip()" tooltip-placement="left" ng-class="vm.getOperationsBadgeClass()">\n        {{vm.getOperationsCount()}}\n      </span>\n    </button>\n  </div>\n</div>\n',e.put("core_generic-ui/generic-ui-inventory-property.html",t),e.put("/apps/core/generic-ui/generic-ui-inventory-property.html",t),t='<div class="card-header">\n  <h4>{{vm.title}}</h4>\n</div>\n<div class="card-inner-scroll" ng-form="MainForm" style="height: 47vh">\n  <div class="list-group">\n    <c8y-generic-ui-inventory-property ng-repeat="property in vm.properties" property="property" operations="property.operationList" context="vm.context" class="list-group-item" create-operation="vm.createOperation(operation, name, property)">\n    </c8y-generic-ui-inventory-property>\n  </div>\n</div>\n<div class="card-footer separator" ng-show="vm.showSave">\n  <button class="btn btn-primary" ng-disabled="MainForm.$invalid || MainForm.$pristine || vm.saving" ng-click="vm.save()" translate>Save</button>\n</div>\n',e.put("core_generic-ui/generic-ui-inventory.html",t),e.put("/apps/core/generic-ui/generic-ui-inventory.html",t),t='<div class="card-group" ng-repeat="row in vm.rows">\n  <div ng-class="vm.cardSizeClass" ng-repeat="card in row">\n    <c8y-generic-ui-inventory class="card" path="card.key" data-title="card.title" schema="card.schema" context="card.managedObject">\n    </c8y-generic-ui-inventory>\n  </div>\n</div>\n',e.put("core_generic-ui/generic-ui.html",t),e.put("/apps/core/generic-ui/generic-ui.html",t)}angular.module("c8y.genericUi").run(["$templateCache",e])}();