/* administration_archivesEditor 8.21.0 2018-01-30T22:07:39+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
!function(){"use strict";function e(e,n){e.when("/applications/:applicationId",{templateUrl:"administration_archivesEditor/views/index.html",controller:"ArchivesListCtrl as ctrl",icon:"archive",name:n("Archives"),showIf:["$routeParams","c8yApplication",i],priority:-4e3})}function i(e,i){return!(!e.applicationId||"new"===e.applicationId)&&i.detail(e.applicationId).then(function(e){var n=i.convertType(e.data);return"HOSTED"===n.type})}angular.module("c8y.parts.appArchives",[]).config(["c8yViewsProvider","gettext",e])}(),function(){function e(e,i,n,t,a,r,s,l){function o(){e.paging={refresh:!0},n.detail(u).then(function(e){c=e.data,d.refresh()})}var c,d=this,u=t.applicationId,p={inProgress:!1,progress:0};this.refresh=e.refresh=function(){return e.refreshLoading=!0,n.listArchives(c).then(function(e){d.archives=e.attachments}).finally(function(){e.refreshLoading=!1})},this.isActiveArchive=function(e){return c.activeVersionId===e.id},this.setActive=function(e){var i=_.cloneDeep(c);i.activeVersionId=e.id,d.requestInProgress=!0,n.save(i).then(function(e){c=e.data}).finally(function(){d.requestInProgress=!1})},this.delete=function(e){return a({title:s("Are you sure?"),body:l.getString("Do you really want to remove archive \"{{name}}{{description ? (' (' + description + ')') : ''}}\"?",e),status:"danger"}).then(function(){return d.requestInProgress=!0,n.deleteArchive(c,e).then(d.refresh).finally(function(){d.requestInProgress=!1})})},this.uploadArchive=function(){var e=i.when();return 6===d.archives.length&&(e=a({title:s("Are you sure?"),body:s("Upto 6 archives can be stored in the platform. If you upload a new archive, the oldest archive that is not active will be deleted. Do you want to proceed?")})),e.then(function(){d.requestInProgress=!0,p.inProgress=!0,p.progress=0;var e=_(d.appArchives).map("file").map(_.partial(n.uploadArchive,c)).value();return _.forEach(e,function(i){i.progress(function(n){i.uploadProgress=n.loaded/n.total,p.progress=_(e).map("uploadProgress").reduce(function(e,i){return e+i})/e.length*100})}),i.all(e).finally(function(){d.requestInProgress=!1,p.inProgress=!1,p.progress=0})}).then(function(e){1===e.length&&i.when(d.setActive(e[0].data)).then(d.refresh).then(function(){r.success(s("Application archive has been uploaded and activated!"))})})},this.uploadStatus=p,o()}angular.module("c8y.parts.appArchives").controller("ArchivesListCtrl",["$scope","$q","c8yApplication","$routeParams","c8yModal","c8yAlert","gettext","gettextCatalog",e])}(),function(){"use strict";function e(e,i,n,t,a){function r(){if(e.uploading)return i.reject();e.uploading=!0;var r=_(e.files).map("file").map(_.partial(t.uploadArchive,a)).value();return _.forEach(r,function(i){i.progress(function(n){i.uploadProgress=n.loaded/n.total,e.uploadProgress=_(r).map("uploadProgress").reduce(function(e,i){return e+i})/r.length})}),i.all(r).then(n.close).finally(function(){e.uploadProgress=100,e.uploading=!1})}e.uploading=!1,e.uploadProgress=0,e.allowMultipleFiles=!1,e.filesRequired=!0,e.files=[],e.upload=r,e.dismiss=n.dismiss}angular.module("c8y.parts.appArchives").controller("ArchivesUploadCtrl",["$scope","$q","$uibModalInstance","c8yApplication","app",e])}(),function(){"use strict";function e(e){var i;i='<c8y-breadcrumbs-set>\n  <c8y-breadcrumbs-item path="#applications" label="{{\'Own applications\' | translate}}" icon="c8y-modules"></c8y-breadcrumbs-item>\n</c8y-breadcrumbs-set>\n\n<c8y-ui-action-bar-set>\n  <c8y-refresh-btn></c8y-refresh-btn>\n</c8y-ui-action-bar-set>\n\n<div class="row">\n  <div class="col-sm-8">\n    <ul class="timeline-list">\n      <li class="timeline-list-item flex-row" ng-repeat="archive in ctrl.archives | orderBy:\'-created\'" ng-class="{\'active\': ctrl.isActiveArchive(archive)}">\n        <small class="timeline-item-date text-right">\n          <strong ng-bind="archive.created |  absoluteDateTimeFormat:\'D MMM YYYY\'"></strong><br/>\n          <span class="text-muted" ng-bind="archive.created | absoluteTime"></span>\n        </small>\n        <div class="timeline-item-content flex-row">\n          <div class="list-item-icon">\n            <i c8y-icon="{{$last ? \'flag-checkered\' : \'file-zip-o\'}}"></i>\n          </div>\n          <div class="list-item-body">\n            <span class="text-truncate"><span ng-bind="archive.name"></span> <small class="text-muted" ng-bind="archive.length | bytes"></small></span>\n            <small class="text-muted" ng-bind="archive.description"></small>\n          </div>\n          <div class="list-item-actions">\n            <div class="dropdown clearfix" ng-if="!ctrl.isActiveArchive(archive)" uib-dropdown>\n              <button type="button" class="dropdown-toggle c8y-dropdown" aria-haspopup="true" aria-expanded="false" uib-dropdown-toggle>\n                <i c8y-icon="ellipsis-v"></i>\n              </button>\n              <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1" uib-dropdown-menu>\n                <li>\n                  <a href="" ng-click="ctrl.setActive(archive)" ng-disabled="ctrl.requestInProgress || refreshLoading">\n                    <i c8y-icon="check-square-o"></i> {{\'Set as active\' | translate}}\n                   </a>\n                </li>\n                <li ng-if="!$last">\n                  <a href="" ng-click="ctrl.delete(archive)" ng-disabled="ctrl.requestInProgress || refreshLoading">\n                    <i c8y-icon="times"></i> {{\'Remove\' | translate}}\n                  </a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <div class="col-sm-4">\n    <c8y-if-allowed any-role="[\'ROLE_INVENTORY_ADMIN\', \'ROLE_INVENTORY_CREATE\']">\n      <file-picker files="ctrl.appArchives" multiple="false" required="true" ng-disabled="ctrl.requestInProgress || refreshLoading" display-drop-zone="true" drop-zone-label="\'Upload archive\' | translate" processing-status="ctrl.uploadStatus" on-file-selected="ctrl.uploadArchive()">\n      </file-picker>\n    </c8y-if-allowed>\n  </div>\n</div>',e.put("administration_archivesEditor/views/index.html",i),e.put("/apps/administration/archivesEditor/views/index.html",i),i='<div class="modal-header" ng-show="title">\n  <h3>{{title | translate}}</h3>\n</div>\n<div class="modal-body">\n  <form role="form" name="filesUploadForm" class="panel-body" novalidate>\n    <div class="form-group">\n      <label translate>Archives to upload</label>\n      <i c8y-icon="question-circle" uib-tooltip="{{\'Compressed files must have an index.html at root. URLs in the web application can be relative.\' | translate}}"></i>\n      <file-picker files="files" multiple="allowMultipleFiles" required="filesRequired" disabled="uploading"></file-picker>\n    </div>\n  </form>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-primary" ng-click="upload()" ng-disabled="filesUploadForm.$invalid || uploading">\n      <span ng-show="uploading"><i c8y-icon="spinner" class="fa-spin"></i> <translate>Uploading</translate>&hellip; ({{uploadProgress|number:0}}%)</span>\n    <span ng-show="!uploading" translate>Upload</span>\n  </button>\n  <button class="btn btn-default" ng-click="dismiss()" ng-disabled="uploading" translate>Cancel</button>\n</div>\n',e.put("administration_archivesEditor/views/upload.html",i),e.put("/apps/administration/archivesEditor/views/upload.html",i)}angular.module("c8y.parts.appArchives").run(["$templateCache",e])}();