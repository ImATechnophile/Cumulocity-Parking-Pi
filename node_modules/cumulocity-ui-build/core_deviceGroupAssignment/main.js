/* core_deviceGroupAssignment 8.21.0 2018-01-30T22:08:27+00:00 ab57d6f7e859+ (release/8.21.0) r8.21.0 */
!function(){"use strict";function e(e,n){e.add({name:"deviceGroupAssignmentWidget",nameDisplay:n("Device group assignment"),description:n("Widget can assign device to selected group"),widgetComponent:"groupAssignment",options:{groupSelectable:!1}})}e.$inject=["c8yComponentsProvider","gettext"],angular.module("c8y.deviceGroupAssignment",[]).config(e)}(),function(){"use strict";function e(e,n,t,o,i,r,c,s,u,a){function p(){_.get(G.config,"device.id")&&(b=_.get(G.config,"device.id"),l(),g())}function l(){return i.directParentAssets(b,A,D).then(d)}function d(e){G.currentGroups=e,i.clearBreadcrumbsCache(b),r.$emit("update")}function g(){return n.all([o.list({type:A}),o.list({fragmentType:D})]).then(_.flattenDeep).then(_.partialRight(_.uniqBy,function(e){return e.id})).then(_.partialRight(_.filter,m)).then(v)}function m(e){return e.id!==b}function v(e){$.length=0,e.forEach(function(e){$.push(e)})}function h(){var n=e.$new();t({templateUrl:"core/scripts/ui/views/deviceDetailBasic/groupSelectModal.html",controller:"c8yGroupSelectModalCtrl",scope:n}).then(function(e){G.group.selected=_.find($,function(n){return n.id===e.id})})}function f(e){return i.detailCached(b).then(s.getResData).then(_.partial(o.addChildAsset,e)).then(l).then(function(){c.success(a("Device added to group"))})}function y(e){return i.detailCached(b).then(s.getResData).then(_.partial(u.unassignDevice,e)).then(l).then(function(){c.success(a("Device removed from group"))})}var b,G=this,A="c8y_DeviceGroup",D="c8y_IsDeviceGroup",$=[];_.assign(G,{group:{},$onInit:p,availableGroups:$,searchGroupInHierarchy:h,addToGroup:f,removeFromGroup:y})}function n(e,n,t,o,i){function r(){o.getTopLevelGroups().then(function(n){e.items=n}),e.breadcrumbs=u,e.currentManagedObjectId=e.device.id}function c(n){return t.detail(n).then(function(e){return e.data}).then(function(n){return o.getGroupItems(n).then(function(t){e.items=t,u.push(n)})})}function s(e){for(;u[u.length-1]!==e;)u.pop();u.pop(),c(e.id)}var u=[];e.title=i("Choose group"),e.drillDown=c,e.upToGroup=s,e.select=n.close,e.dismiss=n.dismiss,e.isGroup=o.isGroup,r()}e.$inject=["$scope","$q","c8yModal","c8yInventory","c8yDevices","c8yBreadcrumbs","c8yAlert","c8yBase","groupsHierarchySvc","gettext"],n.$inject=["$scope","$uibModalInstance","c8yInventory","c8yGroups","gettext"],angular.module("c8y.deviceGroupAssignment").controller("GroupSelectModalCtrl",n).component("groupAssignment",{controller:e,controllerAs:"vm",templateUrl:"core_deviceGroupAssignment/groupAssignment.component.html",bindings:{config:"<"}})}(),function(){"use strict";function e(e){var n;n='\n<ul class="list-group bg-white">\n  <li class="list-group-item" ng-show="vm.currentGroups.length === 0">\n    <div class="c8y-empty-state text-left">\n      <h1 class="c8y-icon c8y-icon-group-open c8y-icon-duocolor"></h1>\n      <p>\n        <strong translate>Device not assigned.</strong><br>\n        <span translate>Assign the device to a group below.</span>\n      </p>\n    </div>\n  </li>\n  <li class="list-group-item word-break" ng-repeat="group in vm.currentGroups | orderBy:\'name\'">\n    <div class="pull-right showOnHover">\n      <button class="btn btn-warning btn-xs" ng-click="vm.removeFromGroup(group)" uib-tooltip="{{\'Unassign device\' | translate}}" tooltip-append-to-body="true">\n      <i c8y-icon="chain-broken"></i>\n    </button>\n    </div>\n    <a ng-href="#/group/{{group.id}}" class="btn btn-clean text-gray-medium">\n      <i c8y-icon="c8y-group"></i> {{group.name}}\n    </a>\n  </li>\n</ul>\n\n<div class="card-block">\n  <div class="input-group top-m-sm">\n    <div c8y-device-group-selector group="vm.group.selected" style="height:34px"></div>\n    <div class="input-group-btn">\n      <button class="btn btn-primary" ng-click="vm.addToGroup(vm.group.selected)" ng-disabled="!vm.group.selected" translate>\n        Assign\n      </button>\n    </div>\n  </div>\n</div>\n',e.put("core_deviceGroupAssignment/groupAssignment.component.html",n),e.put("/apps/core/deviceGroupAssignment/groupAssignment.component.html",n)}angular.module("c8y.deviceGroupAssignment").run(["$templateCache",e])}();